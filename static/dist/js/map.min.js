/*
 pogomap 2016-07-21 
*/
"use strict";!function(){function a(){$("#gyms-switch").prop("checked","true"===localStorage.showGyms),$("#pokemon-switch").prop("checked","true"===localStorage.showPokemon),$("#pokestops-switch").prop("checked","true"===localStorage.showPokestops)}function b(a,b,c,d,e){var f=new Date(b),g=function(a){return a<=99?("0"+a).slice(-2):a},h="\n            <div>\n                <b>"+a+"</b>\n                <span> - </span>\n                <small>\n                    <a href='http://www.pokemon.com/us/pokedex/"+c+"' target='_blank' title='View in Pokedex'>#"+c+"</a>\n                </small>\n            </div>\n            <div>\n                Disappears at "+g(f.getHours())+":"+g(f.getMinutes())+":"+g(f.getSeconds())+"\n                <span class='label-countdown' disappears-at='"+b+"'>(00m00s)</span></div>\n            <div>\n                <a href='https://www.google.com/maps/dir/Current+Location/"+d+","+e+"'\n                        target='_blank' title='View in Maps'>Get directions</a>\n            </div>";return h}function c(a,b,c){var d=["0, 0, 0, .4","74, 138, 202, .6","240, 68, 58, .6","254, 217, 40, .6"],e=void 0;return e=0===a?"<div><center>\n                <div>\n                    <b style='color:rgba("+d[b]+")'>"+a+"</b><br>\n                </div>\n                </center></div>":"\n                <div><center>\n                <div style='padding-bottom: 2px'>Gym owned by:</div>\n                <div>\n                    <b style='color:rgba("+d[b]+")'>Team "+a+"</b><br>\n                    <img height='70px' style='padding: 5px;' src='static/forts/"+a+"_large.png'>\n                </div>\n                <div>Prestige: "+c+"</div>\n                </center></div>"}function d(a){var c=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:m,icon:"static/icons/"+a.pokemon_id+".png"});return c.infoWindow=new google.maps.InfoWindow({content:b(a.pokemon_name,a.disappear_time,a.pokemon_id,a.latitude,a.longitude)}),g(c),c}function e(a){var b=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:m,icon:"static/forts/"+t[a.team_id]+".png"});return b.infoWindow=new google.maps.InfoWindow({content:c(t[a.team_id],a.team_id,a.gym_points)}),g(b),b}function f(a){var b=a.lure_expiration?"PstopLured":"Pstop",c=new google.maps.Marker({position:{lat:a.latitude,lng:a.longitude},map:m,icon:"static/forts/"+b+".png"});return c.infoWindow=new google.maps.InfoWindow({content:"I'm a Pok√©stop, and soon enough I'll tell you more things about me."}),g(c),c}function g(a){return a.addListener("click",function(){a.infoWindow.open(m,a),u(),a.persist=!0}),google.maps.event.addListener(a.infoWindow,"closeclick",function(){a.persist=null}),a.addListener("mouseover",function(){a.infoWindow.open(m,a),u()}),a.addListener("mouseout",function(){a.persist||a.infoWindow.close()}),a}function h(){$.each(q,function(a,b){(q[a].disappear_time<(new Date).getTime()||l.indexOf(q[a].pokemon_id)>=0)&&(q[a].marker.setMap(null),delete q[a])})}function i(){localStorage.showPokemon=localStorage.showPokemon||!0,localStorage.showGyms=localStorage.showGyms||!0,localStorage.showPokestops=localStorage.showPokestops||!0,$.ajax({url:"raw_data",type:"GET",data:{pokemon:localStorage.showPokemon,pokestops:localStorage.showPokestops,gyms:localStorage.showGyms},dataType:"json"}).done(function(a){$.each(a.pokemons,function(a,b){return!!localStorage.showPokemon&&void(!(b.encounter_id in q)&&l.indexOf(b.pokemon_id)<0&&(b.marker&&b.marker.setMap(null),b.marker=d(b),q[b.encounter_id]=b))}),$.each(a.pokestops,function(a,b){return!!localStorage.showPokestops&&void(b.pokestop_id in s||(b.marker&&b.marker.setMap(null),b.marker=f(b),s[b.pokestop_id]=b))}),$.each(a.gyms,function(a,b){return!!localStorage.showGyms&&void(b.gym_id in r?r[b.gym_id].team_id!=b.team_id?(r[b.gym_id].marker.setMap(null),r[b.gym_id].marker=e(b)):r[b.gym_id].marker.infoWindow=new google.maps.InfoWindow({content:c(t[b.team_id],b.team_id,b.gym_points)}):(b.marker&&b.marker.setMap(null),b.marker=e(b),r[b.gym_id]=b))}),h()})}function j(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}var k=$("#exclude-pokemon");$.getJSON("static/locales/pokemon.en.json").done(function(a){var b=[];$.each(a,function(a,c){b.push({id:a,text:c})}),JSON.parse(j("remember_select")),k.select2({placeholder:"Select Pokemon to exclude",data:b}),k.val(JSON.parse(j("remember_select"))).trigger("change")});var l=[];k.on("change",function(a){l=k.val().map(Number),h(),document.cookie="remember_select="+JSON.stringify(l)+"; max-age=31536000; path=/"});var m=void 0,n=[{elementType:"geometry",stylers:[{hue:"#ff4400"},{saturation:-68},{lightness:-4},{gamma:.72}]},{featureType:"road",elementType:"labels.icon"},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{hue:"#0077ff"},{gamma:3.1}]},{featureType:"water",stylers:[{hue:"#00ccff"},{gamma:.44},{saturation:-33}]},{featureType:"poi.park",stylers:[{hue:"#44ff00"},{saturation:-23}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{hue:"#007fff"},{gamma:.77},{saturation:65},{lightness:99}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{gamma:.11},{weight:5.6},{saturation:99},{hue:"#0091ff"},{lightness:-86}]},{featureType:"transit.line",elementType:"geometry",stylers:[{lightness:-48},{hue:"#ff5e00"},{gamma:1.2},{saturation:-23}]},{featureType:"transit",elementType:"labels.text.stroke",stylers:[{saturation:-64},{hue:"#ff9100"},{lightness:16},{gamma:.47},{weight:2.7}]}],o=[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#b39964"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#181818"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{lightness:17},{color:"#525252"}]}],p=[{featureType:"landscape.man_made",elementType:"geometry.fill",stylers:[{color:"#a1f199"}]},{featureType:"landscape.natural.landcover",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"landscape.natural.terrain",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"poi.attraction",elementType:"geometry.fill",stylers:[{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry.fill",stylers:[{color:"#e4dfd9"}]},{featureType:"poi.business",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry.fill",stylers:[{color:"#37bda2"}]},{featureType:"road",elementType:"geometry.fill",stylers:[{color:"#84b09e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#fafeb8"},{weight:"1.25"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#5ddad6"}]}];window.initMap=function(){m=new google.maps.Map(document.getElementById("map"),{center:{lat:center_lat,lng:center_lng},zoom:16,streetViewControl:!1,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,"dark_style","style_light2","style_pgo"]}});var b=new google.maps.StyledMapType(o,{name:"Dark"});m.mapTypes.set("dark_style",b);var c=new google.maps.StyledMapType(n,{name:"Light2"});m.mapTypes.set("style_light2",c);var d=new google.maps.StyledMapType(p,{name:"PokemonGo"});m.mapTypes.set("style_pgo",d),m.addListener("maptypeid_changed",function(a){localStorage.map_style=this.mapTypeId}),localStorage.map_style=localStorage.map_style||"roadmap",m.setMapTypeId(localStorage.map_style);new google.maps.Marker({position:{lat:center_lat,lng:center_lng},map:m,animation:google.maps.Animation.DROP});a()};var q={},r={},s={},t=["Uncontested","Mystic","Valor","Instinct"];window.setInterval(i,5e3),i(),document.getElementById("gyms-switch").onclick=function(){localStorage.showGyms=this.checked,this.checked?i():($.each(r,function(a,b){r[a].marker.setMap(null)}),r={})},$("#pokemon-switch").change(function(){localStorage.showPokemon=this.checked,this.checked?i():($.each(q,function(a,b){q[a].marker.setMap(null)}),q={})}),$("#pokestops-switch").change(function(){localStorage.showPokestops=this.checked,this.checked?i():($.each(s,function(a,b){s[a].marker.setMap(null)}),s={})});var u=function(){$(".label-countdown").each(function(a,b){var c=new Date(parseInt(b.getAttribute("disappears-at"))),d=new Date,e=Math.abs(c-d),f=Math.floor(e/36e5),g=Math.floor((e-36e5*f)/6e4),h=Math.floor((e-36e5*f-6e4*g)/1e3);c<d?timestring="(expired)":(timestring="(",f>0&&(timestring=f+"h"),timestring+=("0"+g).slice(-2)+"m",timestring+=("0"+h).slice(-2)+"s",timestring+=")"),$(b).text(timestring)})};window.setInterval(u,1e3)}();